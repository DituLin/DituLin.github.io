<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="知识带来自由"><title>仿高德路径选项卡 | Atu's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">仿高德路径选项卡</h1><a id="logo" href="/.">Atu's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">仿高德路径选项卡</h1><div class="post-meta">Jul 23, 2017<span> | </span><span class="category"><a href="/categories/android/">android</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p>最近一直在研究高德地图提供的电子眼、导航、定位相关，利用周末时间写个博客梳理一下这阶段对于高德地图的使用，主要参考高德api和参考手册。</p>
<p>在高德导航页面中，有一个路径选项卡，需要切换不同的路径方案，这个功能简单的看来就是一个 RadioGroup 包含一些 RadioButton 实现单选框效果。如下图：</p>
<p><img src="amap_navi1.jpg" alt="amap"></p>
<p>而 RadioButton 并不能实现所需要的样式，每个子 Item 中包含该 3 个 TextView ，获得数据然后赋到控件上。</p>
<h4 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h4><ul>
<li>写一个子 item 布局，然后在代码中根据规划的路径数动态添加，并实现单选的逻辑。这种自己写单选的逻辑代码量相对较多，也不变日后需求变化的维护。</li>
<li>利用 GridView ，然后根据路径数实现添加，数据为空不显示，实现起来相对简单，日后修改布局也易修改。</li>
<li>参考 RadioGroup 和 RadioButton 重写一个子 item 布局，用于数据展示，一个 Group 实现单选功能。</li>
</ul>
<p>采用第三种方法来实现，相当于利用两个控件就能实现，在子 item 不多的情况下，既可以在 xml 布局直接添加，又可以在代码中动态添加。</p>
<p>首先写一个子 item 的xml 布局：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line">    &lt;LinearLayout</div><div class="line">        android:layout_width=&quot;100dp&quot;</div><div class="line">        android:layout_height=&quot;64dp&quot;</div><div class="line">        android:orientation=&quot;vertical&quot;</div><div class="line">        android:id=&quot;@+id/ll_route_info_frame&quot;</div><div class="line">        android:background=&quot;@drawable/bg_gray_frame&quot;&gt;</div><div class="line">        &lt;LinearLayout</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:id=&quot;@+id/ll_route_info_title&quot;</div><div class="line">            android:background=&quot;@drawable/bg_gray_title&quot;&gt;</div><div class="line">            &lt;TextView</div><div class="line">                android:layout_width=&quot;match_parent&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:maxLines=&quot;1&quot;</div><div class="line">                android:ellipsize=&quot;end&quot;</div><div class="line">                android:maxEms=&quot;7&quot;</div><div class="line">                android:id=&quot;@+id/tv_route_info_title&quot;</div><div class="line">                android:textColor=&quot;@color/gray&quot;</div><div class="line">                android:gravity=&quot;center&quot;</div><div class="line">                android:textSize=&quot;12sp&quot;/&gt;</div><div class="line">        &lt;/LinearLayout&gt;</div><div class="line">        &lt;LinearLayout</div><div class="line">            android:layout_width=&quot;match_parent&quot;</div><div class="line">            android:layout_height=&quot;match_parent&quot;</div><div class="line">            android:orientation=&quot;vertical&quot;</div><div class="line">            android:id=&quot;@+id/ll_route_info_content&quot;</div><div class="line">            android:background=&quot;@drawable/bg_gray_content&quot;</div><div class="line">            android:gravity=&quot;center&quot;&gt;</div><div class="line"></div><div class="line">            &lt;TextView</div><div class="line">                android:layout_width=&quot;match_parent&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:id=&quot;@+id/tv_route_info_time&quot;</div><div class="line">                android:textColor=&quot;@color/black&quot;</div><div class="line">                android:textStyle=&quot;bold&quot;</div><div class="line">                android:gravity=&quot;center&quot;/&gt;</div><div class="line"></div><div class="line">            &lt;TextView</div><div class="line">                android:layout_width=&quot;match_parent&quot;</div><div class="line">                android:layout_height=&quot;wrap_content&quot;</div><div class="line">                android:id=&quot;@+id/tv_route_info_distance&quot;</div><div class="line">                android:textColor=&quot;@color/gray&quot;</div><div class="line">                android:textSize=&quot;10sp&quot;</div><div class="line">                android:gravity=&quot;center&quot;/&gt;</div><div class="line">        &lt;/LinearLayout&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;/LinearLayout&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<p>之后将其整体封装为一个组合控件，并添加展示数据的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">public class RouteInfoLayout extends FrameLayout &#123;</div><div class="line">    private View view;</div><div class="line">    private TextView tvTitle;</div><div class="line">    private TextView tvTime;</div><div class="line">    private TextView tvDistance;</div><div class="line">    private LinearLayout llFrame;</div><div class="line">    private LinearLayout llTitle;</div><div class="line">    private LinearLayout llContent;</div><div class="line"></div><div class="line">    private Boolean isChecked;</div><div class="line"></div><div class="line"></div><div class="line">    public RouteInfoLayout(@NonNull Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public RouteInfoLayout(@NonNull Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        view = View.inflate(context, R.layout.view_route_info_item, this);</div><div class="line">        tvTitle = (TextView) view.findViewById(R.id.tv_route_info_title);</div><div class="line">        tvDistance = (TextView) view.findViewById(R.id.tv_route_info_distance);</div><div class="line">        tvTime = (TextView) view.findViewById(R.id.tv_route_info_time);</div><div class="line">        llFrame = (LinearLayout) view.findViewById(R.id.ll_route_info_frame);</div><div class="line">        llContent = (LinearLayout) view.findViewById(R.id.ll_route_info_content);</div><div class="line">        llTitle = (LinearLayout) view.findViewById(R.id.ll_route_info_title);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public RouteInfoLayout(@NonNull Context context, @Nullable AttributeSet attrs, @AttrRes int defStyleAttr) &#123;</div><div class="line">        super(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setChecked(Boolean isChecked) &#123;</div><div class="line">        if (isChecked == this.isChecked) &#123;</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        if (isChecked) &#123;</div><div class="line">            llTitle.setBackgroundResource(R.drawable.bg_blue_title);</div><div class="line">            llFrame.setBackgroundResource(R.drawable.bg_blue_frame);</div><div class="line">            llContent.setBackgroundResource(R.drawable.bg_blue_content);</div><div class="line">            tvTitle.setTextColor(getContext().getResources().getColor(R.color.white));</div><div class="line">            tvTime.setTextColor(getContext().getResources().getColor(R.color.blue_light));</div><div class="line">            tvDistance.setTextColor(getContext().getResources().getColor(R.color.blue_light));</div><div class="line">        &#125; else &#123;</div><div class="line">            llContent.setBackgroundResource(R.drawable.bg_gray_content);</div><div class="line">            llFrame.setBackgroundResource(R.drawable.bg_gray_frame);</div><div class="line">            llTitle.setBackgroundResource(R.drawable.bg_gray_title);</div><div class="line">            tvTitle.setTextColor(getContext().getResources().getColor(R.color.gray));</div><div class="line">            tvTime.setTextColor(getContext().getResources().getColor(R.color.black));</div><div class="line">            tvDistance.setTextColor(getContext().getResources().getColor(R.color.gray));</div><div class="line">        &#125;</div><div class="line">        this.isChecked = isChecked;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public boolean isChecked() &#123;</div><div class="line">        return this.isChecked;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setRouteInfoTitle(String s) &#123;</div><div class="line">        if (!StringUtils.isNullOrEmpty(s)) &#123;</div><div class="line">            tvTitle.setText(s);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setRouteInfoTime(int value) &#123;</div><div class="line">        int hour;</div><div class="line">        int minute;</div><div class="line">        minute = value / 60;</div><div class="line">        hour = minute / 60;</div><div class="line">        if (hour == 0 &amp;&amp; minute != 0) &#123;</div><div class="line">            tvTime.setText(minute + &quot;分钟&quot;);</div><div class="line">        &#125; else if (hour != 0 &amp;&amp; minute == 0) &#123;</div><div class="line">            tvTime.setText(hour + &quot;小时&quot;);</div><div class="line">        &#125; else if (hour != 0 &amp;&amp; minute != 0) &#123;</div><div class="line">            tvTime.setText(hour + &quot;小时&quot; + (minute - 60 * hour) + &quot;分钟&quot;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setRouteInfoDistance(int value) &#123;</div><div class="line"></div><div class="line">        if (value&gt;1000) &#123;</div><div class="line">            float kilometre;</div><div class="line">            String result;</div><div class="line">            kilometre = (float) value / 1000;</div><div class="line">            DecimalFormat df = new DecimalFormat(&quot;0.0&quot;);</div><div class="line">            result = df.format(kilometre);</div><div class="line">            tvDistance.setText(result + &quot;公里&quot;);</div><div class="line">        &#125; else &#123;</div><div class="line">            tvDistance.setText(value + &quot;米&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就可以在xml中使用子 item 控件，相当于 RadioButton,这是还需要一个如 RadioGroup 的控件。参考 RadioGroup 控件的源码，找到这一个监听：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mPassThroughListener = new PassThroughHierarchyChangeListener();  </div><div class="line">super.setOnHierarchyChangeListener(mPassThroughListener);</div></pre></td></tr></table></figure>
<p>其对应的监听内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">private class PassThroughHierarchyChangeListener implements  </div><div class="line">           ViewGroup.OnHierarchyChangeListener &#123;  </div><div class="line">       private ViewGroup.OnHierarchyChangeListener mOnHierarchyChangeListener;  </div><div class="line">  </div><div class="line">       /** </div><div class="line">        * &#123;@inheritDoc&#125; </div><div class="line">        */  </div><div class="line">       public void onChildViewAdded(View parent, View child) &#123;  </div><div class="line">           if (parent == RadioGroup.this &amp;&amp; child instanceof RadioButton) &#123;  </div><div class="line">               int id = child.getId();  </div><div class="line">               // generates an id if it&apos;s missing  </div><div class="line">               if (id == View.NO_ID) &#123;  </div><div class="line">                   id = View.generateViewId();  </div><div class="line">                   child.setId(id);  </div><div class="line">               &#125;  </div><div class="line">               ((RadioButton) child).setOnCheckedChangeWidgetListener(  </div><div class="line">                       mChildOnCheckedChangeListener);  </div><div class="line">           &#125;  </div><div class="line">  </div><div class="line">           if (mOnHierarchyChangeListener != null) &#123;  </div><div class="line">               mOnHierarchyChangeListener.onChildViewAdded(parent, child);  </div><div class="line">           &#125;  </div><div class="line">       &#125;  </div><div class="line">  </div><div class="line">       /** </div><div class="line">        * &#123;@inheritDoc&#125; </div><div class="line">        */  </div><div class="line">       public void onChildViewRemoved(View parent, View child) &#123;  </div><div class="line">           if (parent == RadioGroup.this &amp;&amp; child instanceof RadioButton) &#123;  </div><div class="line">               ((RadioButton) child).setOnCheckedChangeWidgetListener(null);  </div><div class="line">           &#125;  </div><div class="line">  </div><div class="line">           if (mOnHierarchyChangeListener != null) &#123;  </div><div class="line">               mOnHierarchyChangeListener.onChildViewRemoved(parent, child);  </div><div class="line">           &#125;  </div><div class="line">       &#125;  </div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>这个监听接口是对其 层次结构的监听，不像onMeasure或onLayout，他只有在层次结构发生变化时，也就是说在添加view和移除view的时候才会调用，所以他有两个回调方法。onChildViewAdded和onChildViewRemoved。在初始化的时候，子布局是一个一个的被添加到RadioGroup，所以调用onChildViewAdded，可以得带其对应的孩子，就可以对其设置监听了。</p>
<p>接着改变子控件的状态，RouteInfoGroup 代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div></pre></td><td class="code"><pre><div class="line">public class RouteInfoGroup extends LinearLayout &#123;</div><div class="line">    private ArrayList&lt;Integer&gt; tabChildsId = new ArrayList&lt;Integer&gt;();</div><div class="line">    /**</div><div class="line">     * 记录当前id，默认id为-1</div><div class="line">     */</div><div class="line">    private int mCheckedId = -1;</div><div class="line">    private int defaultid;</div><div class="line">    private CheckedStateTracker mChildOnCheckedChangeListener;</div><div class="line">    private PassThroughHierarchyChangeListener mPassThroughListener;</div><div class="line">    private OnItemTabClickListener listener;</div><div class="line"></div><div class="line">    public RouteInfoGroup(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public RouteInfoGroup(Context context, @Nullable AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    public RouteInfoGroup(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</div><div class="line">        super(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void init() &#123;</div><div class="line">        // radiobutton的监听</div><div class="line">        mChildOnCheckedChangeListener = new CheckedStateTracker();</div><div class="line"></div><div class="line">        // 层次结构的监听</div><div class="line">        mPassThroughListener = new PassThroughHierarchyChangeListener();</div><div class="line">        // 设置监听</div><div class="line">        super.setOnHierarchyChangeListener(mPassThroughListener);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置tab数据</div><div class="line">     *</div><div class="line">     * @param datas</div><div class="line">     */</div><div class="line">    public void setDataOfTabs(List&lt;AMapNaviPath&gt; datas) &#123;</div><div class="line">        L.i(&quot;TAG2&quot;,&quot;getChildCount()===&gt;&gt;&gt;&quot;+getChildCount());</div><div class="line">        L.i(&quot;TAG2&quot;,&quot;datas()===&gt;&gt;&gt;&quot;+datas.size());</div><div class="line">        int count = 0;</div><div class="line">        if (datas.size() &gt;= getChildCount()) &#123;</div><div class="line">            count = getChildCount();</div><div class="line">//          return;</div><div class="line">        &#125;else&#123;</div><div class="line">            count = datas.size();</div><div class="line">        &#125;</div><div class="line">        for (int i = 0; i &lt; count; i++) &#123;</div><div class="line">            L.i(&quot;TAG2&quot;,&quot;data=1111==&gt;&gt;&gt;&quot;);</div><div class="line">            RouteInfoLayout view = (RouteInfoLayout) findViewById(tabChildsId.get(i));</div><div class="line">            AMapNaviPath data = datas.get(i);</div><div class="line">            L.i(&quot;TAG2&quot;,&quot;data===&gt;&gt;&gt;&quot;+data);</div><div class="line">            if (i == 0) &#123;</div><div class="line">                check(view.getId());</div><div class="line">                defaultid = view.getId();</div><div class="line">            &#125;</div><div class="line">            view.setRouteInfoDistance(data.getAllLength());</div><div class="line">            view.setRouteInfoTime(data.getAllTime());</div><div class="line">            view.setRouteInfoTitle(data.getLabels());</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onFinishInflate() &#123;</div><div class="line">        super.onFinishInflate();</div><div class="line">        L.i(&quot;TAG2&quot;, &quot;onFinishInflate=111==&gt;&gt;&gt;&gt;&quot;);</div><div class="line">        check(mCheckedId);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    /**</div><div class="line">     * 改变item的选择状态</div><div class="line">     *</div><div class="line">     * @param viewId</div><div class="line">     * @param checked</div><div class="line">     *            true 为选择，false 为不选择</div><div class="line">     */</div><div class="line">    private void setCheckedStateForView(int viewId, boolean checked) &#123;</div><div class="line">        L.i(&quot;TAG2&quot;, &quot;setCheckedStateForView====&gt;&gt;&gt;&quot;);</div><div class="line">        View checkedView = findViewById(viewId);</div><div class="line">        L.i(&quot;TAG2&quot;, &quot;setCheckedStateForView===checkedView=&gt;&gt;&gt;&quot; + checkedView);</div><div class="line">        if (checkedView != null &amp;&amp; checkedView instanceof RouteInfoLayout) &#123;</div><div class="line">            ((RouteInfoLayout) checkedView).setChecked(checked);</div><div class="line">            L.i(&quot;TAG2&quot;, &quot;setCheckedStateForView===checkedView=111&gt;&gt;&gt;&quot;</div><div class="line">                    + checkedView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    public void check(int id) &#123;</div><div class="line">        // don&apos;t even bother</div><div class="line">        L.i(&quot;TAG2&quot;, &quot;check=000======&gt;&gt;&gt;&quot; + id);</div><div class="line">        L.i(&quot;TAG2&quot;, &quot;check=000=11=====&gt;&gt;&gt;&quot; + mCheckedId);</div><div class="line">        if (id != -1 &amp;&amp; (id == mCheckedId)) &#123;</div><div class="line">            L.i(&quot;TAG2&quot;, &quot;check=111======&gt;&gt;&gt;&quot; + id);</div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (mCheckedId != -1) &#123;</div><div class="line">            L.i(&quot;TAG2&quot;, &quot;check=222======&gt;&gt;&gt;&quot; + id);</div><div class="line">            setCheckedStateForView(mCheckedId, false);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (id != -1) &#123;</div><div class="line">            L.i(&quot;TAG2&quot;, &quot;check=333======&gt;&gt;&gt;&quot; + id);</div><div class="line">            setCheckedStateForView(id, true);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        setCheckedId(id);</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 选择Item后要执行的操作</div><div class="line">     *</div><div class="line">     * @param id</div><div class="line">     */</div><div class="line">    private void setCheckedId(int id) &#123;</div><div class="line">        // 更新当前选择的Item的id</div><div class="line">        mCheckedId = id;</div><div class="line">        if (listener != null) &#123;</div><div class="line">            RouteInfoLayout view = (RouteInfoLayout) findViewById(id);</div><div class="line"></div><div class="line">            listener.onItemClick(view, defaultid);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置点击item的监听</div><div class="line">     *</div><div class="line">     * @param l</div><div class="line">     */</div><div class="line">    public void setOnItemTabClickListener(OnItemTabClickListener l) &#123;</div><div class="line">        this.listener = l;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * item选择监听 Title: RechargeValueGroup.java Description:</div><div class="line">     *</div><div class="line">     * @author Liusong</div><div class="line">     * @date 2015-6-26</div><div class="line">     * @version V1.0</div><div class="line">     */</div><div class="line">    public interface OnItemTabClickListener &#123;</div><div class="line">        public void onItemClick(RouteInfoLayout view, int defaultid);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 图层变换监听 Title: RechargeValueGroup.java Description:</div><div class="line">     *</div><div class="line">     * @author Liusong</div><div class="line">     * @date 2015-6-26</div><div class="line">     * @version V1.0</div><div class="line">     */</div><div class="line">    private class PassThroughHierarchyChangeListener implements</div><div class="line">            ViewGroup.OnHierarchyChangeListener &#123;</div><div class="line">        private ViewGroup.OnHierarchyChangeListener mOnHierarchyChangeListener;</div><div class="line"></div><div class="line">        /**</div><div class="line">         * &#123;@inheritDoc&#125;</div><div class="line">         */</div><div class="line">        public void onChildViewAdded(View parent, View child) &#123;</div><div class="line">            if (parent == RouteInfoGroup.this</div><div class="line">                    &amp;&amp; child instanceof RouteInfoLayout) &#123;</div><div class="line">                int id = child.getId();</div><div class="line">//              Log.i(&quot;TAG2&quot;, &quot;onChildViewAdded=111==&gt;&gt;&gt;&gt;&quot; + id);</div><div class="line">                // generates an id if it&apos;s missing</div><div class="line">                if (id == View.NO_ID) &#123;</div><div class="line">                    id = View.generateViewId();</div><div class="line">                    child.setId(id);</div><div class="line">                &#125;</div><div class="line">                tabChildsId.add(id);</div><div class="line">                ((RouteInfoLayout) child)</div><div class="line">                        .setOnClickListener(mChildOnCheckedChangeListener);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if (mOnHierarchyChangeListener != null) &#123;</div><div class="line">                mOnHierarchyChangeListener.onChildViewAdded(parent, child);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        /**</div><div class="line">         * &#123;@inheritDoc&#125;</div><div class="line">         */</div><div class="line">        public void onChildViewRemoved(View parent, View child) &#123;</div><div class="line">            if (parent == RouteInfoGroup.this</div><div class="line">                    &amp;&amp; child instanceof RouteInfoLayout) &#123;</div><div class="line">                ((RouteInfoLayout) child).setOnClickListener(null);</div><div class="line">                tabChildsId.remove(0);</div><div class="line">            &#125;</div><div class="line">            if (mOnHierarchyChangeListener != null) &#123;</div><div class="line">                mOnHierarchyChangeListener.onChildViewRemoved(parent, child);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 每一项Item的点击事件 Title: RechargeValueGroup.java Description:</div><div class="line">     *</div><div class="line">     * @author Liusong</div><div class="line">     * @date 2015-6-26</div><div class="line">     * @version V1.0</div><div class="line">     */</div><div class="line">    class CheckedStateTracker implements OnClickListener &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onClick(View v) &#123;</div><div class="line">            check(v.getId());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>自此两个控件写好 RouteInfoGroup 与 RouteInfoLayout，现在只需要在 xml 或在代码中 addView 既可。由于路径数并不是固定的，将采用在xml 中布局 RouteInfoGroup，然后代码中动态 addView RouteInfoLayout。(使用方法如 RadioGroup 和 RadioButton)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">mRouteInfoGroup = (RouteInfoGroup) findViewById(R.id.routeInfoGroup);</div><div class="line">if (mRouteInfoGroup.getChildCount() != 0) &#123;</div><div class="line">   mRouteInfoGroup.removeAllViews();//清空上次子 item</div><div class="line">&#125;</div><div class="line">....</div><div class="line">RouteInfoLayout routeInfoLayout = new RouteInfoLayout(this,null);</div><div class="line">            routeInfoLayout.setId(id+i);</div><div class="line">            if (i == 0 ) &#123;</div><div class="line">                routeInfoLayout.setChecked(true);</div><div class="line">            &#125;</div><div class="line">            LinearLayout.LayoutParams llparams = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT);</div><div class="line">            llparams.weight = 1.0f;//权重</div><div class="line">            if (ints.length == 3 &amp;&amp; i == 1) &#123;</div><div class="line">                llparams.leftMargin = 32;//边距</div><div class="line">                llparams.rightMargin = 32;</div><div class="line">            &#125;else if (ints.length == 2) &#123;</div><div class="line">                if (i == 0) &#123;</div><div class="line">                    llparams.rightMargin = 100;//边距</div><div class="line">                &#125;else &#123;</div><div class="line">                    llparams.leftMargin = 100;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            mRouteInfoGroup.addView(routeInfoLayout,llparams);</div></pre></td></tr></table></figure>
<p>效果图如下：</p>
<p><img src="amap_navi2.jpg" alt=""></p>
<p>参考：<a href="http://blog.csdn.net/ls703/article/details/46694967" target="_blank" rel="external">http://blog.csdn.net/ls703/article/details/46694967</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/07/23/仿高德路径选项卡/" data-id="cjasdygta0023fsnkprl24xvp" class="article-share-link">分享</a><div class="tags"><a href="/tags/地图/">地图</a></div><div class="post-nav"><a href="/2017/07/31/读恶意/" class="pre">读《恶意》</a><a href="/2017/07/03/2017年中总结/" class="next">2017年中总结</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书/">读书</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/组件化/" style="font-size: 15px;">组件化</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/视频/" style="font-size: 15px;">视频</a> <a href="/tags/样式/" style="font-size: 15px;">样式</a> <a href="/tags/技巧/" style="font-size: 15px;">技巧</a> <a href="/tags/读书/" style="font-size: 15px;">读书</a> <a href="/tags/nexus/" style="font-size: 15px;">nexus</a> <a href="/tags/流程分析/" style="font-size: 15px;">流程分析</a> <a href="/tags/地图/" style="font-size: 15px;">地图</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/05/DDComponentForAndroid组件化的使用和分析/">DDComponentForAndroid 组件化的使用和分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/27/Mac 搭建本地 nexus-maven 仓库/">Mac 搭建本地 nexus-maven 仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/15/HTTP 权威指南（笔记三）/">HTTP 权威指南（笔记三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/05/HTTP 权威指南（笔记二）/">HTTP 权威指南（笔记二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/30/HTTP 权威指南（笔记一）/">HTTP 权威指南笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/YUV420详解/">YUV420 详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/18/CSS 笔记四/">CSS3 笔记四</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/读《许三观卖血记》/">读《许三观卖血记》</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/11/CSS3 笔记三/">CSS3 笔记三</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/构造网页（笔记二）/">构造网页（笔记二）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Atu's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>